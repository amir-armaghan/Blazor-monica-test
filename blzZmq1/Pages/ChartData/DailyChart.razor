@page "/chartdata/dailychart"
@* Usings *@
@using blzZmq1.Services
@using blzZmq1.Components
@using blzZmq1.Services.ChartData
@using Core.Daily

@* Injects *@
@inject IDailyChartService DailyChartService


<h3>Daily Chart</h3>

<SpinLoader IsLoading="isLoading">
    <LoadingTemplate>
        <Chase Center="true"></Chase>
    </LoadingTemplate>
    <ContentTemplate>
        <Highchart Json="@chartjson">
        </Highchart>
       
    </ContentTemplate>
</SpinLoader>




@code{

    
    Boolean isLoading = true;
    private DailyData dailyData = null;
    string chartjson;

    //protected override async Task OnInitializedAsync()
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {

            dailyData = await DailyChartService.GetDailyChartDataAsync();

            string chartTypeName = "area";  // has to get from json
            string chartTitleName = "Monica Model from json message";
            string chartOrigSpec = "Daily";

            string xAxsis = "";


            for (int i = 0; i < dailyData.Dates.Count; i++)
            {
                xAxsis += "'" + dailyData.Dates[i] + "' , ";
            }

            string series = "[";
            foreach (var outputId in dailyData.DailyOutputIds)
            {
                if (outputId.Name == Core.Share.MonicaConstFields.Crop)
                    continue;

                series += "{ name: '" + outputId.Name + "', data: [";

                for (int i = 0; i < outputId.Results.Count; i++)
                {
                    series += outputId.Results[i].ToString().Replace(",", ".") + " , ";
                }

                series += "] },";

            }
            series += "]";

            chartjson = @" {
chart: {
zoomType: 'x',
height: 600,
type: '" + chartTypeName + @"',

},
colors: [
'#063c75',
'#1c8c44',
'#881452',
'#280137',
'#63a194',
'#2c3539',
'#428bca',
'#d9534f',
'#96ceb4',
'#80699B',
'#3D96AE',
'#DB843D',
'#92A8CD',
'#A47D7C',
'#B5CA92'],
title: {
text: '" + chartTitleName + @"'
},

subtitle: {
 text: '" + chartOrigSpec + @"'
},

yAxis: {
title: {
text: ' '
},
maxZoom: 2
},

xAxis: {
title: {
text: 'Date'
},
categories: [" + xAxsis + @"],
},

legend: {
layout: 'vertical',
align: 'right',
verticalAlign: 'middle'
},

plotOptions: {
area: {
    fillColor: {
        linearGradient: {
            x1: 0,
            y1: 0,
            x2: 0,
            y2: 0.6
         },
        stops: [
                [0, Highcharts.getOptions().colors[0]],
                [1, Highcharts.color(Highcharts.getOptions().colors[0]).setOpacity(0).get('rgba')]
            ]
    },
    marker: {
        radius: 2
    },
    lineWidth: 1,
    states: {
        hover: {
        lineWidth: 1
        }
    },
    threshold: null
}
},

series:" + series + @",

responsive: {
rules: [{
    condition: {
    maxWidth: 500
    },
    chartOptions: {
        legend: {
        layout: 'horizontal',
        align: 'center',
        verticalAlign: 'bottom'
        }
     }
}]
},
navigation: {
buttonOptions: {
    align: 'right'
}
},
exporting: {
sourceWidth: 1600,
scale: 1
},


}";
        }
        if (isLoading)  // prevent a forever loop
        {
            isLoading = false;
            StateHasChanged();
        }
        //isLoading = false;
        //StateHasChanged(); 
    }

}
